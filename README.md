# Фронтенд приложения «Спринты нейроинтеграции»

## Для запуска

1. ```npm install```
2. ```npm run dev```

## Для разработчиков

Платформа - набор универсальных компонентов для переиспользования в рамках веб-приложения

1. Старайтесь максимально переиспользовать платформенные компоненты
2. Ознакомьтесь с css переменными и стилями, созданными в рамках Платформы.

# Документация проекта “Нейроспринт” 
# Ссылки

[https://d5do0kibuf11u2a6rbpt.kf69zffa.apigw.yandexcloud.net](https://d5do0kibuf11u2a6rbpt.kf69zffa.apigw.yandexcloud.net) \- прод  
[https://d5dp5i0dp3aoisd6asdk.l3hh3szr.apigw.yandexcloud.net](https://d5dp5i0dp3aoisd6asdk.l3hh3szr.apigw.yandexcloud.net/sprint) \- тест, но там сейчас почему-то не работает авторизация через телеграм (надо разбираться). 

Деплоить в репозитории фронтенда можно через графический интерфейс гита раздельно в тест и в прод.  
Actions \-\> Deploy React App to Object Storage \-\> Run workflow \-\> выбрать test или prod \-\> Run workflow

Для локального тестирования (и любого тестирования без авторизации через телеграм) предусмотрена тестовая авторизация с тестовыми пользователями.
Чтобы включить режим тестирования, нужно в localstorage для текущего адреса дописать ключ **isAutotest** со значением **true**
После этого появится поля для ввода логина и пароля.
Логин: client, пароль: Client1\! – для клиента
Либо логин: trainer, пароль: Trainer1\! – для тренера

# Бизнес-контекст

Спринты нейроинтеграции – психологический метод, созданный Международным Институтом Нейроинтеграции. С их помощью человек может научиться лучше планировать своё время, начать контролировать своё моральное и физическое состояние, найти свои сильные и слабые стороны и отследить изменения в себе.

Для этого он с помощью тренера, сертифицированного институтом, выполняет определённые действия в рамках спринтов. Один спринт – четыре недели.

На каждый спринт планируются проекты, которые, в свою очередь, делятся на задачи. Каждый проект принадлежит к одному из трёх направлений:

* «Лайф» – то, что необходимо человеку для хорошего физического самочувствия;  
*  «Кайф» – то, что необходимо человеку для отдыха;  
*  «Драйв» – то, над чем человеку приходится трудиться, например, рабочие или учебные задачи.

При планировании на каждый проект закладывается определённое количество времени, по неделям или в общем. В ходе спринта клиент отмечает количество времени, фактически затраченного на проект, и совместно с тренером отслеживает отклонения реальной картины от плана и корректирует курс.

Помимо проектов в методе есть упражнения «Стендап» и «Рефлексия».

Стендап заключается в том, что каждый вечер клиент должен описывать, что ему удалось сделать за день и что он планирует сделать завтра, а также трижды в день отмечать своё состояние по шкале от 1 до 7, где цифры соответствуют состоянию человека в этот момент времени.

1.  «Апатия».  
2.  «Пассивность».  
3.  «Расслабленность».  
4.  «Баланс».  
5.  «Включенность».  
6.  «Перевозбуждение».  
7. «Паника».

Рефлексия же проводится в конце каждой недели спринта и, в свою очередь, делится на два типа: регулярную, которая проходит в конце трёх недель спринта, и интеграционную, которая проходит на четвёртой, заключительной неделе спринта и служит для подведения итогов. Оба вида рефлексии подразумевают ответы на определённый ряд вопросов.

Регулярная рефлексия:

* «Что я сделал?»  
*  «Что я не сделал?»  
* «Что влияло на моё состояние?»  
*  «По каким орбитам отношения к ситуации я прошёл?»  
* «Что стоит скорректировать?»

Интеграционная рефлексия:

*  «Что изменилось?»  
* «Что я для этого делал?»  
*  «Какие способности пригодились?»  
* «Что я теперь думаю о своих возможностях?»  
*  «Что я теперь думаю о себе?»  
*  «Что я теперь могу на самом деле?»


В рамках предмета «Проектный практикум» было реализовано веб‑приложение для организации работы клиента и тренера по спринтам нейроинтеграции. В нём можно: 

* работать с проектами:  
  * создавать,  
  * редактировать,  
  * удалять,  
  * планировать время,   
  * отмечать фактическое время,  
  * добавлять-редактировать-удалять подзадачи  
  * просматривать историю проектов.  
* смотреть результаты стендапа и рефлексии.

Также уже существует Telegram‑бот для прохождения стендапов и рефлексий, с которым интегрировано приложение.

Регистрация в системе происходит через бота, приложение только забирает данные. Без регистрации в боте работа с приложением невозможна.

# Фронтенд-документация

## Папка public

### **icons**

В этой папке лежат все иконки.

### **onboarding**

Эту папку можно удалить, предварительно проверив, что ничего не сломается.   
В ней лежат скриншоты к старой версии обучения перед началом работы – там показывалось 11 скриншотов.  
Сейчас это обучение заменено на всплывающие модальные окна.

### **Другое** {#другое}

Ещё здесь лежит дефолтная аватарка-лоадер с прыгающим котиком.  
И иконка для отображения на телефоне.

## Папка src

### **Корневые файлы**

#### **main**

Здесь приложение рендерится и оборачивается в StrictMode – это позволяет выявлять некоторые ошибки в коде заранее.

#### **App**

В App.tsx лежит код для формирования приложения со всеми его обёртками:

* AuthProvider для авторизации  
* Стейт-менеджер Recoil  
* AppRouter для маршрутизации

В App.css лежат стили, которые применяются ко всему приложению.

### **Platform**

#### **Компоненты**

Для многих базовых компонентов исходно были прописаны стили и поведение, единые для всего приложения.  
Однако из\-за очень сжатых сроков в конце разработки в коде появлялись места, где тоже заданы аналогичные компоненты (например, кнопки).   
Их было бы хорошо отрефакторить, чтобы базовые компоненты задавались в одном месте.

**\_buttons**  
Здесь заданы стили и поведение для кнопок \<Button\>.

Кроме того здесь заданы стили и поведение элемента \<Spoiler\> – кнопки, которая разворачивает/сворачивает панель под ней.

**\_common-custom**  
Здесь задан стиль для заглушки, появляющейся, когда по запросу не было найдено ни одного элемента, например, в указанные даты.

**\_dropdownSelector**  
Здесь описаны стили и поведение для базового компонента выпадающего списка. Применяется для реализации элемента выбора спринта/недели спринта.

**\_inputs**  
Здесь заданы стили и поведение для текстовых полей ввода. Плюс задан кастомный хук useWindowDimensions() для изменения размеров элемента при изменении размеров окна.

**\_tabs**  
Здесь заданы стили и поведение для переключателя вкладок “Лайф”, “Кайф” и “Драйв”. И сами вкладки.

**\_times**  
Здесь задано два важных компонента:

* Отображение времени в карточке проекта.  
* Редактирование времени в карточке проекта.

\<TimeComparer\> задаёт отображение пары из запланированного и фактического времени выполнения проекта/задачи в карточке проекта/задачи. Применяется в компоненте \<EventCard\>.  
Может быть вертикальным, если карточка открыта в режиме “за весь спринт”.  
Или горизонтальным, если отображение идёт только за 1 неделю.

\<TimeEditor\> задаёт редактор времени на экране/в лайтбоксе редактирования данных проекта/задачи. Применяется в компоненте \<EditorUnit\> 

Есть особенность: TimeType \- тип времени, содержащий в себе минуты, часы и статус (Продолжить, отказаться от проекта, скорректировать план), задан в папке core/api/actions/projects.ts

#### **Типы**

В папке \_types заданы некоторые типы и перечисления, применяющиеся в коде:

* AnswerTypes \- виды ответов на вопросы бота для Стендапа и Рефлексии, используется для того, чтобы понять, в какой раздел класть тот или иной ответ, полученный из базы ответов. К примеру, “Что я сегодня сделал” или “Что я сегодня не сделал”.  
* Fonts \- размеры шрифтов.  
* Icons \- пути к иконкам.  
* ReflectionsTypes \- типы рефлексий, регулярная, интеграционная и общая (применяется как некий базовый тип, в котором содержатся оба предыдущих, чтобы тайпскрипт не ругался). Плюс enum с именами классов для вёрстки рефлексии.   
* Statuses \- enum с названиями секций: Лайф, Кайф и Драйв.

#### **Стили**

Здесь заданы некоторые базовые стили:

* Цвета  
* Флекс-элементы  
* Шрифты \+ обрезка текста  
* Отступы  
* Размеры шрифтов и карточек  
* 

И класс .sr-only для визуального скрытия элементов. Например, невидимых обычному глазу, но читаемых при помощи скринридера заголовков экранов.

### **core**

#### **api**

**actions**  
В этой папке заданы все методы получения данных, изменения данных, добавления данных, удаления данных по API.

me

* Данные о текущем пользователе  
* Роль текущего пользователя: только клиент или клиент и тренер  
* Изменение данных текущего пользователя

projects

* Получение проектов за конкретный  спринт  
* Получение конкретного проекта  
* Добавление, изменение и удаление проекта

reflection

* Получение всех рефлексий  
* Получение рефлексии за конкретный спринт

sprints

* Получение всех спринтов  
* Получение конкретного спринта по его номеру

standup \- по аналогии с рефлексиями

* Получение всех стендапов  
* Получение стендапов за конкретный спринт

tasks

* Получение всех подзадач конкретного проекта  
* Получение конкретной подзадачи  
* Добавление, изменение, удаление конкретной подзадачи.

trainer.clients \- методы для работы тренера с информацией о его клиенте

* Получение списка всех клиентов тренера  
* Получение конкретного клиента  
* Получение и изменение комментария тренера к конкретному клиенту

trainer.events \- методы для работы тренера с проектами и задачами его клиента

* Получение спринтов клиента  
* Получение проектов за спринт  
* Получение, добавление, изменение и удаление конкретного проекта  
* Получение всех задач проекта  
* Получение, добавление, изменение и удаление задачи  
* Получение стендапа и рефлексии за спринт

И методы для авторизации:

* Логин через телеграм-бота  
* Логаут  
* Обновление токена  
* Тестовая авторизация по заданным логину и паролю (применяется только для тестирования локально).

**components**  
Здесь задан один компонент \- AuthProvider.  
Через него происходит авторизация и задание всех атомов состояний после неё.

**hooks**  
Здесь реализован хук useHttpLoader, который помогает управлять состоянием загрузки и ловить состояния ошибки при выполнении асинхронных HTTP-запросов.

**utils**  
atomPersistenceMaker – утилита сохраняет состояние атома в localstorage браузера, а потом при обновлении перезаписывает атом оттуда. Таким образом атом сохраняется при обновлении страницы.   
Использовать утилиту можно только для нечувствительных данных. Сейчас таким образом сохраняется выбранный в выпадающем списке спринт.

dateCutter – утилита обрезает и форматирует дату под привычный формат с точками.

DateDiff – утилита проверяет, что дата находится между двумя другими датами.

DateSummarizator – утилита складывает две даты.

httpHandlers \- настраивает Axios-клиент с перехватчиками (interceptors), чтобы автоматически управлять авторизацией через JWT-токены, их обновлением и обработкой ошибок.

* автоматически подставляет Bearer-токен,  
* обновляет accessToken, если он устарел,  
* разлогинивает пользователя при критических ошибках,  
* приводит все ответы к унифицированному формату.

localStorageCleaner – утилита очищает localstorage от сохранённых там состояний.

reflectionAnswersTransformer \- утилита парсит полученные по запросу к базе данные ответов про рефлексию в тип ReflectionRegistryProps – для удобной работы с этими данными при дальннейшем отображении их в интерфейсе.   
Данные при этом

* Структурируются \- укладываются в 4 недели, в жёсткую структуру с обязательными элементами, чтобы потом уложить её в жёсткую сетку, где даже отсутствующий ответ должен отрисовываться как элемент.  
* Для каждого ответа добавляется заголовок, имя класса, индекс (для кейса, когда в одной ячейке сетки лежат ответы “Что я сделал” и “Что я не сделал”, чтобы различать их – у остальных ответов индекс всегда \= 0\) и тип рефлексии.

standupAnswersTransformer – аналогично утилита парсит данные ответов на вопросы стендапов в тип StandupCardProps для формирования одной карточки стендапа.  
Т.е. из ответов извлекаются

* Номер спринта  
* Дата   
* Состояния пользователя за день (3 ответа)  
* Победы пользователя за день (1 ответ)  
* Фокусы на следующий день – по секциям Лайф, Кайф и Драйв (по 1 ответу на каждую секцию).

renderingDelayer – замедлитель рендеринга. Изначально предназначался для задержки рендеринга карточек обучения, чтобы атомы состояний успели прогрузиться, и в систему попали данные, нужно ли вообще отрисовывать обучения.  
Не факт, что помогает.

tokenDecoder – декодер токенов, тут больше нечего сказать.

#### **atoms**

Для сохранения состояний используется стейт-менеджер Recoil. Он сохраняет состояние в атомах \- объектах с заданным ключом и данными, которые можно записывать и хранить.

В папке atoms заданы атомы состояний для

* токенов авторизации  
* истории спринтов  
* данных текущего пользователя  
* флагов пройденности/не пройденности обучения  
* роли пользователя  
* выбранных в выпадающем списке спринтов  
* выбранного раздела \- лайф, кайф или драйв  
* текущего спринта  
* спринта стендапа  
* спринта рефлексии

#### **routing**

Здесь заданы сами пути для страниц веб\-приложения и маршрутизация по страницам, связанным с этими путями.

### **application**

#### **components**

Компоненты реализуются в директории application/components, если это какие-то компоненты бизнес-логики.

\_cards

* AddTaskCard – карточка создания нового проекта или задачи. Фактически является кнопкой.  
* EventCard – карточка самого проекта или задачи (зависит от типа ивента). Имеет два вида – краткий и полный. Краткий – при режиме отображения за неделю, полный – за весь спринт. Содержит:  
  * Данные о запланированном и фактическом времени за неделю или за весь спринт – в зависимости от выбранного режима отображения.  
  * Название проекта/задачи.  
  * Кнопку для разворачивания списка задач, если это карточка проекта.  
* newOnboarding – всплывающие карточки обучения. Есть одна обёртка, в которую передаётся необходимый тип карточки и набор обработчиков для кликов. Внутри уже вызывается нужный вид карточки в зависимости от клика. Всего пока что сделано 4 карточки обучения:  
  * На списке проектов – для выпадающего списка, где можно задать режим отображения (за неделю или за весь спринт).  
  * На списке проектов – для проекта, не показывается, если нет ни одного проекта или если не просмотрена карточка обучения для выпадающего списка.  
  * На списке клиентов  
  * На экране для редактирования  
* ReflectionCard – карточка рефлексии, содержит заголовок и текст, либо два текста, если это рефлексия “Что удалось сделать \- что не удалось сделать”..  
* StandupCard – карточка стендапа, все данные по стендапу за 1 день. Т.е. дата, три (или меньше) отмеченных состояния, победы, фокусы на следующий день по секциям Лайф, Кайф и Драйв.

\_controllers

* EditorFormController – метод-контроллер, который выбирает, какой именно метод редактирования нужно применить в зависимости от того, редактируется проект или задача, впервые или повторно. И от того, какая кнопка на странице редактирования нажата. Т.е. в конечном итоге выдаёт 1 метод обращения к API:  
  * Создание проекта  
  * Создание задачи  
  * Редактирование проекта  
  * Редактирование задачи  
  * Удаление проекта  
  * Удаление задачи  
  * Создание проекта клиенту  
  * Создание задачи клиенту  
  * Редактирование проекта клиента  
  * Редактирование задачи клиента  
  * Удаление проекта клиента  
  * Удаление задачи клиента

\_editors

* EditorUnit и его подкомпоненты – блок редактирования фактического/запланированного времени для проекта или задачи за какой-то промежуток времени (спринт или неделя), содержащий поля для изменения запланированного и фактического времени по часам и минутам, быстрые кнопки, а также три цветовые оценки на выбор.  
* EventTitleEditor – редактор названия проекта/задачи, применяется только на странице редактирования, в лайтбоксе редактирования изменить название нельзя.  
* EventSectionEditor – редактор секции проекта (Лайф, Кайф или Драйв) на случай, если пользователь ошибся. Тоже есть только для страницы редактирования.

\_dialogs

* EditorDialog – модальное окно, открывающееся вместо страницы редактирования, если выбран режим отображения списка проектов за конкретную неделю.

\_registry

* EventRegistry – список карточек проектов и их подзадач.  
* BaseRegistry – обёртка над списком карточек проектов, включающая в себя ещё базовый компонент DropdownSelector, позволяющий задавать отображение списка проектов – за неделю или за спринт, а также выбирать спринты, если речь идёт про экран истории. Кроме того, именно в BaseRegistry передаётся тип списка проектов – спринт клиента, спринт пользователя или история, и в зависимости от этого меняются вызываемые для проектов методы API, функциональность внутри редактора и т.д.  
* ReflectionRegistry – способ отображения карточек рефлексий для экранов мобильных устройств, список карточек подряд по неделям в порядке заданных ботом вопросов. Каждую неделю можно свернуть и развернуть по клику на кнопку со стрелочкой.

\_sidebar

* Sidebar – компонент, реализующий отображение кнопки меню и выдвигающейся при нажатии на кнопку меню панели навигации.

\_grids

* ReflectionGrid – способ отображения карточек рефлексий для экранов компьютеров, жёсткая сетка, где каждая карточка занимает своё определённое место. Места карточек определяются по их именам классов для вёрстки. Имена присваиваются в reflectionAnswersTransformer с помощью заданного перечисления определённых имён. Каждое имя состоит из имени и номера – номер равен номеру недели.

#### **screens**

В директории /application/screens располагаются файлы страниц приложения и локальные стили для них. Именно функциональные компоненты из этих файлов вызываются при помощи React Router при переходе на страницу с соответствующим адресом.

* Auth.tsx – страница авторизации со ссылкой на Telegram-бота «Баланси», без регистрации в котором невозможна работа в приложении.

* Clients.tsx – страница с карточками всех клиентов, указавших пользователя своим тренером.

* ClientSprint.tsx, ClientStandup.tsx, ClientReflection.tsx – страницы, на которых тренер может посмотреть и отредактировать проекты и задачи клиента в текущем спринте, плюс посмотреть даннные стендапов и рефлексий клиента. Состоят из разворачиваемого блока с информацией о клиенте и обычных страниц спринта, стендапа и рефлексии под этим блоком.

* EventEditing.tsx – страница редактирования проекта за весь спринт, где можно изменить название проекта и запланированное или фактическое время за весь спринт, а также задать ему цветовую оценку. Или добавить проект в текущий спринт, если эта страница была открыта из истории.

* History.tsx – страница истории, где можно посмотреть все проекты и все задачи за предыдущие спринты пользователя.

* Standup.tsx – страница с данными стендапов. На ней можно посмотреть все ответы пользователя в боте в рамках прохождения стендапов за выбранный спринт (за все дни, когда пользователь их проходил). Меняет свою структуру в зависимости от ширины экрана.

* Reflection.tsx – страница с данными рефлексий. На ней можно посмотреть все ответы пользователя в боте в рамках прохождения рефлексии за выбранный спринт. Меняет свою структуру в зависимости от ширины экрана.

* Sprint.tsx – страница, реализующая отображение списка проектов пользователя в текущем спринте.

* Settings.tsx – страница настроек, где можно задать количество недель в спринте (три или четыре), указать своего тренера, ввести информацию о себе и снова активировать прохождение обучения.

* TEMPORARY – внутри лежит тот самый тестовый экран авторизации для того, чтобы заходить в приложение по логину и паролю.
